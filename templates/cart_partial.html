<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">

<h2>Shopping Cart</h2>
<ul>
    {% for cart_item in cart %}
    <li>
        <span class="cart-item-name" data-name="{{ cart_item.name }}">
            {{ cart_item.name }}</span>
        ${{ cart_item.price }} x {{ cart_item.quantity }}
        <div class="quantity-controls">
            <a href="javascript:void(0)" onclick="updateQuantity('{{ cart_item.id }}', 'decrease')">-</a>
            <a href="javascript:void(0)" onclick="updateQuantity('{{ cart_item.id }}', 'increase')">+</a>
        </div>
        <a href="javascript:void(0)" onclick="removeItem('{{ cart_item.id }}')" class="remove-btn">x</a>
    </li>
    {% endfor %}
</ul>
<p>Total Price: ${{ total_price }}</p>
<a href="{{ url_for('checkout') }}" class="checkout-btn">Checkout</a>
<script>
// 장바구니 항목의 번역을 다시 적용하는 함수
function reapplyCartTranslations() {
    const cartItems = document.querySelectorAll(".cart-item-name");
    cartItems.forEach(cartItem => {
        const originalName = cartItem.getAttribute("data-name");
        if (languageData[currentLanguage]?.menu_items?.[originalName]) {
            cartItem.innerText = languageData[currentLanguage].menu_items[originalName];
        }
    });
}

// 장바구니 수량 업데이트 함수
function updateQuantity(itemId, action) {
    // 서버에 수량 변경 요청
    fetch(`/update_quantity/${itemId}/${action}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 서버로부터 받은 HTML로 장바구니 내용 업데이트
                document.getElementById("cart").innerHTML = data.cart_html;
                reapplyCartTranslations(); // 번역 재적용
            } else {
                console.error('수량 업데이트 실패:', data.error);
            }
        })
        .catch(error => console.error('Error:', error)); // 에러 처리
}

// 장바구니 항목 제거 함수
function removeItem(itemId) {
    // 서버에 항목 제거 요청
    fetch(`/remove_item/${itemId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // 서버로부터 받은 HTML로 장바구니 내용 업데이트
                document.getElementById("cart").innerHTML = data.cart_html;
                reapplyCartTranslations(); // 번역 재적용
            } else {
                console.error('항목 제거 실패:', data.error);
            }
        })
        .catch(error => console.error('Error:', error)); // 에러 처리
}
</script>